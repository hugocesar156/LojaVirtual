@model List<LojaVirtual.Models.Produto.Produto>

@{
    ViewData["Title"] = "Carrinho de Compras";
}

<div class="text-center">
    <h4>Carrinho de Compras</h4>

    @if (Model != null && Model.Count > 0)
    {
        <div class="row mt-5">
            <div class="col-8">
                <div class="table-responsive" style="overflow-y: scroll; height: 289px; background-color: #fafafa;">
                    <table class="table table-hover">
                        <thead class="text-muted">
                            <tr class="small text-uppercase">
                                <th scope="col"></th>
                                <th scope="col" width="300">Produto</th>
                                <th scope="col" class="text-center" width="170">Quantidade</th>
                                <th scope="col">Preço</th>
                                <th scope="col" class="text-right"> </th>
                            </tr>
                        </thead>
                        <tbody id="lista">
                            @await Html.PartialAsync("_Carrinho")
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h5>Resumo</h5>
                    </div>
                    <div class="card-body">
                        @{ var subtotal = 0; }

                        @foreach (var item in Model)
                        {
                            subtotal += item.Valor * ViewBag.Quantidade[item.IdProduto];
                        }

                        <div class="row text-left">
                            <div class="col">
                                <strong>Subtotal:</strong>
                                R$ <label id="subtotal">@subtotal.ToString("C").Replace("R$", "")</label>
                            </div>
                        </div>
                        <div class="row text-left">
                            <div class="col">
                                <strong>Frete:</strong>
                                R$ <label id="frete">0,00</label>
                            </div>
                        </div>
                        <div class="row justify-content-center">
                            <div class="col col-form-label-lg">
                                <strong>Total:</strong>
                                R$ <label id="total">@subtotal.ToString("C").Replace("R$", "")</label>
                            </div>
                        </div>
                        <hr />
                        <div class="row justify-content-center mt-3">
                            <button type="button" class="btn btn-outline-success col-11"
                                    data-toggle="modal" data-target="#pagamento">
                                Formas de pagamento
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row text-left mt-3">
            <div class="col-2">
                <button class="btn btn-sm btn-primary" type="button"
                        data-toggle="modal" data-target="#calculo-frete">
                    Alterar endereço
                </button>
            </div>
            <div class="col-2 text-right">
                <label>Serviço de entrega:</label>
            </div>
            <div class="col-1 text-right">
                <input class="form-check-input" type="radio" name="frete" id="sedex-input" checked onchange="CalcularFrete($('#cep').val().replace('-', ''))">
                <label class="form-check-label" for="sedex-input">SEDEX</label>
            </div>
            <div class="col-1">
                <input class="form-check-input" type="radio" name="frete" id="sedex-input" onchange="CalcularFrete($('#cep').val().replace('-', ''))">
                <label class="form-check-label" for="sedex-input">PAC</label>
            </div>
        </div>
    }
    else
    {
        <div class="mt-5">
            <p>Você ainda não possui nenhum item no carrinho.</p>
        </div>
    }
</div>

<div class="modal fade" id="calculo-frete" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Endereço</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <div class="row">
                    <div class="col">
                        <label>CEP</label>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-6">
                        <div class="input-group">
                            <input type="text" class="form-control cep" id="cep" placeholder="00000-000"
                                   value="@ViewBag.Cep" style="text-align: center;" />
                            <div class="input-group-prepend">
                                <button type="button" class="btn btn-outline-secondary" id="btn-frete" onclick="ValidaCep()">OK</button>
                            </div>
                            <div id="cep" class="invalid-feedback text-left">CEP inválido</div>
                        </div>
                    </div>
                </div>
                <div id="area-endereco" class="d-none mt-3">
                    <div class="row">
                        <div class="col" id="endereco">

                        </div>
                    </div>
                    <div class="row justify-content-center mt-2">
                        <button class="btn btn-outline-danger col-2" id="retira-endereco" type="button" onclick="RetiraEndereco()">Alterar</button>
                    </div>
                </div>
                <div class="row justify-content-center mt-3">
                    <div class="col-3">
                        <div class="d-none" id="load">
                            <img src="" id="load-gif" height="35" width="35" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>

<div class="modal fade" id="pagamento" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Pagamento</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <div class="text-center">
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow">
                                <div class="card-body mt-3 mb-3">
                                    <ul class="nav nav-pills active show nav-fill" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" data-toggle="pill" href="#cartao"><i class="fa fa-credit-card"></i> Cartão de crédito</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="pill" href="#boleto"><i class="fa fa-file-alt"></i> Boleto bancário</a>
                                        </li>
                                    </ul>

                                    <div class="tab-content">
                                        <div class="tab-pane active" id="cartao">
                                            <div class="row mt-4 justify-content-center">
                                                <div class="col-10 text-left">
                                                    <label>Número do cartão</label>
                                                    <div class="input-group">
                                                        <input class="form-control cartao" type="text" placeholder="0000 0000 0000 0000"
                                                               id="numero" style="text-align: center;" />
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text"><i class="fa fa-credit-card"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3 justify-content-center">
                                                <div class="col-5 text-left">
                                                    <label>Data de expiração</label>
                                                    <div class="input-group">
                                                        <input class="form-control data" type="text" placeholder="mm/aa"
                                                               id="vencimento" style="text-align: center;" />
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-5 text-left">
                                                    <label>Código verificador</label>
                                                    <div class="input-group">
                                                        <input class="form-control num-3" type="text" placeholder="000"
                                                               id="verificador" style="text-align: center;" />
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text"><i class="fa fa-lock"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr />
                                            <div class="row mt-4 justify-content-center">
                                                <button class="btn btn-outline-success col-8" type="button" onclick="PreparaTransacao()">Realizar pagamento</button>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="boleto">
                                            <div class="row mt-5 justify-content-center">
                                                <button class="btn btn-outline-success col-6" type="button">Imprimir boleto</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/jquery/jquery-3.5.1.min.js"></script>
<script src="~/js/Carrinho/acoes.js"></script>
<script src="~/js/Pagamento/acoes.js"></script>